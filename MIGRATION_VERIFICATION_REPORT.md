# –û—Ç—á–µ—Ç –æ –ø—Ä–æ–≤–µ—Ä–∫–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

## –î–∞—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏
2025-12-30

## –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–∏

### –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
- ‚úÖ **–¢–∞–±–ª–∏—Ü —Å–æ–∑–¥–∞–Ω–æ**: 14
- ‚úÖ **–ó–∞–ø–∏—Å–µ–π —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ**: 238
- ‚ùå **–¢–∞–±–ª–∏—Ü —Å –æ—à–∏–±–∫–∞–º–∏**: 0 (–Ω–æ –µ—Å—Ç—å –ø—Ä–æ–±–ª–µ–º—ã —Å foreign keys)

### –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–∞–±–ª–∏—Ü–∞–º

| –¢–∞–±–ª–∏—Ü–∞ | –ó–∞–ø–∏—Å–µ–π —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ | –°—Ç–∞—Ç—É—Å |
|---------|---------------------|--------|
| admin_users | 2 | ‚úÖ |
| bookings | 0 | ‚úÖ (–ø—É—Å—Ç–∞—è —Ç–∞–±–ª–∏—Ü–∞) |
| cart_orders | 0 | ‚úÖ (–ø—É—Å—Ç–∞—è —Ç–∞–±–ª–∏—Ü–∞) |
| cities | 2 | ‚úÖ |
| city_recommended_dishes | 12 | ‚úÖ |
| menu_categories | 18 | ‚ö†Ô∏è **–ü–†–û–ë–õ–ï–ú–ê** |
| menu_items | 190 | ‚úÖ |
| payments | 0 | ‚úÖ (–ø—É—Å—Ç–∞—è —Ç–∞–±–ª–∏—Ü–∞) |
| promotions | 4 | ‚úÖ |
| restaurant_payments | 0 | ‚úÖ (–ø—É—Å—Ç–∞—è —Ç–∞–±–ª–∏—Ü–∞) |
| restaurants | 2 | ‚úÖ |
| user_addresses | 0 | ‚úÖ (–ø—É—Å—Ç–∞—è —Ç–∞–±–ª–∏—Ü–∞) |
| user_carts | 0 | ‚úÖ (–ø—É—Å—Ç–∞—è —Ç–∞–±–ª–∏—Ü–∞) |
| user_profiles | 8 | ‚úÖ |

## –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞: –ù–∞—Ä—É—à–µ–Ω–∏–µ foreign key constraint

**–ü—Ä–æ–±–ª–µ–º–∞**: –í —Ç–∞–±–ª–∏—Ü–µ `menu_categories` –µ—Å—Ç—å –∑–∞–ø–∏—Å–∏ —Å `restaurant_id='pnz23-–ø–µ–Ω–∑–∞'`, –Ω–æ —Ç–∞–∫–æ–≥–æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞ –Ω–µ—Ç –≤ —Ç–∞–±–ª–∏—Ü–µ `restaurants`.

**–î–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏**:
```
ERROR: insert or update on table "menu_categories" violates foreign key constraint "fk_menu_categories_restaurant"
DETAIL: Key (restaurant_id)=(pnz23-–ø–µ–Ω–∑–∞) is not present in table "restaurants".
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è**:
1. ‚ùå Foreign key constraint `fk_menu_categories_restaurant` –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–æ–∑–¥–∞–Ω
2. ‚ùå –ó–∞–ø—Ä–æ—Å—ã –∫ API –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –æ—à–∏–±–∫—É "–†–µ—Å—Ç–æ—Ä–∞–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω" –¥–ª—è `restaurantId=pnz23-–ø–µ–Ω–∑–∞`
3. ‚ö†Ô∏è –î–∞–Ω–Ω—ã–µ –≤ `menu_categories` —Å—Å—ã–ª–∞—é—Ç—Å—è –Ω–∞ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Ä–µ—Å—Ç–æ—Ä–∞–Ω

**–õ–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç**:
- –ó–∞–ø—Ä–æ—Å: `GET /api/booking/slots?restaurantId=pnz23-–ø–µ–Ω–∑–∞&date=2025-12-30&guests_count=2&with_rooms=false`
- –†–µ–∑—É–ª—å—Ç–∞—Ç: `404 - –†–µ—Å—Ç–æ—Ä–∞–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω`

### ‚ö†Ô∏è –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è

1. **–î—É–±–ª–∏–∫–∞—Ç—ã constraints**: –ù–µ–∫–æ—Ç–æ—Ä—ã–µ UNIQUE constraints –ø—ã—Ç–∞–ª–∏—Å—å —Å–æ–∑–¥–∞—Ç—å—Å—è –¥–≤–∞–∂–¥—ã, –Ω–æ —ç—Ç–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ (–ø—Ä–æ–ø—É—â–µ–Ω—ã —Å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ–º).

2. **–ü–æ—Ä—è–¥–æ–∫ —Å–æ–∑–¥–∞–Ω–∏—è foreign keys**: Foreign keys —Å–æ–∑–¥–∞—é—Ç—Å—è –ø–æ—Å–ª–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö, —á—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –ø—Ä–æ–±–ª–µ–º–∞–º, –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ —Å—Å—ã–ª–∞—é—Ç—Å—è –Ω–∞ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∑–∞–ø–∏—Å–∏.

## –ê–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö

### –†–µ—Å—Ç–æ—Ä–∞–Ω—ã –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

–ò–∑ –ª–æ–≥–æ–≤ –≤–∏–¥–Ω–æ, —á—Ç–æ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –µ—Å—Ç—å **2 —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞**, –Ω–æ –∏—Ö —Ç–æ—á–Ω—ã–µ ID –Ω–µ —É–∫–∞–∑–∞–Ω—ã –≤ –ª–æ–≥–∞—Ö. –û–¥–Ω–∞–∫–æ –∏–∑–≤–µ—Å—Ç–Ω–æ, —á—Ç–æ:
- –í `menu_categories` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `restaurant_id='pnz23-–ø–µ–Ω–∑–∞'`
- –≠—Ç–æ—Ç ID –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ —Ç–∞–±–ª–∏—Ü–µ `restaurants`

### –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã

1. **–ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ ID**: –í –∏—Å—Ö–æ–¥–Ω–æ–π –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –º–æ–≥ –±—ã—Ç—å —Ä–µ—Å—Ç–æ—Ä–∞–Ω —Å ID `pnz23-–ø–µ–Ω–∑–∞`, –Ω–æ –ø—Ä–∏ –º–∏–≥—Ä–∞—Ü–∏–∏ –æ–Ω –Ω–µ –±—ã–ª —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –∏–ª–∏ –±—ã–ª —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω —Å –¥—Ä—É–≥–∏–º ID.

2. **–ü—Ä–æ–±–ª–µ–º–∞ —Å –∫–æ–¥–∏—Ä–æ–≤–∫–æ–π**: ID —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–∏—Ä–∏–ª–ª–∏—Ü—É (`–ø–µ–Ω–∑–∞`), —á—Ç–æ –º–æ–≥–ª–æ –≤—ã–∑–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã –ø—Ä–∏ –º–∏–≥—Ä–∞—Ü–∏–∏.

3. **–ü–æ—Ä—è–¥–æ–∫ –º–∏–≥—Ä–∞—Ü–∏–∏**: –í–æ–∑–º–æ–∂–Ω–æ, `menu_categories` –º–∏–≥—Ä–∏—Ä–æ–≤–∞–ª–∞—Å—å —Ä–∞–Ω—å—à–µ `restaurants`, –∏ –¥–∞–Ω–Ω—ã–µ –±—ã–ª–∏ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã –¥–æ —Ç–æ–≥–æ, –∫–∞–∫ —Ä–µ—Å—Ç–æ—Ä–∞–Ω –±—ã–ª —Å–æ–∑–¥–∞–Ω.

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é

### –í–∞—Ä–∏–∞–Ω—Ç 1: –£–¥–∞–ª–∏—Ç—å –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ –∑–∞–ø–∏—Å–∏ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

–ï—Å–ª–∏ —Ä–µ—Å—Ç–æ—Ä–∞–Ω `pnz23-–ø–µ–Ω–∑–∞` –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –Ω–µ –Ω—É–∂–µ–Ω –∏–ª–∏ –±—ã–ª —É–¥–∞–ª–µ–Ω:

```sql
-- –£–¥–∞–ª–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –º–µ–Ω—é –¥–ª—è –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞
DELETE FROM menu_categories WHERE restaurant_id = 'pnz23-–ø–µ–Ω–∑–∞';

-- –ó–∞—Ç–µ–º –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å foreign key constraint
ALTER TABLE menu_categories
DROP CONSTRAINT IF EXISTS fk_menu_categories_restaurant;

ALTER TABLE menu_categories
ADD CONSTRAINT fk_menu_categories_restaurant
FOREIGN KEY (restaurant_id)
REFERENCES restaurants(id)
ON DELETE CASCADE;
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –°–æ–∑–¥–∞—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–π —Ä–µ—Å—Ç–æ—Ä–∞–Ω

–ï—Å–ª–∏ —Ä–µ—Å—Ç–æ—Ä–∞–Ω –¥–æ–ª–∂–µ–Ω —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å, –Ω–æ –±—ã–ª –ø—Ä–æ–ø—É—â–µ–Ω –ø—Ä–∏ –º–∏–≥—Ä–∞—Ü–∏–∏:

1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å—Ö–æ–¥–Ω—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –Ω–∞–ª–∏—á–∏–µ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞ —Å ID `pnz23-–ø–µ–Ω–∑–∞`
2. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –µ–≥–æ –¥–∞–Ω–Ω—ã–µ –≤ —Ü–µ–ª–µ–≤—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
3. –ó–∞—Ç–µ–º –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å foreign key constraint

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

–ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫—Ä–∏–ø—Ç `backend/server/scripts/fixMigrationIssues.mjs`:

```bash
cd backend/server
node scripts/fixMigrationIssues.mjs
```

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç:
- –ù–∞–π–¥–µ—Ç –≤—Å–µ –∑–∞–ø–∏—Å–∏ —Å –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ foreign key —Å—Å—ã–ª–∫–∞–º–∏
- –£–¥–∞–ª–∏—Ç –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ –∑–∞–ø–∏—Å–∏
- –ü–æ–ø—ã—Ç–∞–µ—Ç—Å—è –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å foreign key constraints

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö

–î–ª—è –ø–æ–ª–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∑–∞–ø—É—Å—Ç–∏—Ç—å:

```bash
cd backend/server
node scripts/verifyMigration.mjs
```

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç:
- –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∑–∞–ø–∏—Å–µ–π –º–µ–∂–¥—É –∏—Å—Ö–æ–¥–Ω–æ–π –∏ —Ü–µ–ª–µ–≤–æ–π –ë–î
- –í—Å–µ –Ω–∞—Ä—É—à–µ–Ω–∏—è foreign key constraints
- –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ —Å—Å—ã–ª–∫–∏ –≤–æ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö

## –í—ã–≤–æ–¥—ã

### ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ö–æ—Ä–æ—à–æ:
1. –ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –¥–∞–Ω–Ω—ã—Ö —É—Å–ø–µ—à–Ω–æ –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ (238 –∑–∞–ø–∏—Å–µ–π)
2. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü —Å–æ–∑–¥–∞–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
3. –ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ foreign key constraints —Å–æ–∑–¥–∞–Ω—ã —É—Å–ø–µ—à–Ω–æ
4. –ò–Ω–¥–µ–∫—Å—ã –∏ constraints —Å–æ–∑–¥–∞–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

### ‚ùå –ß—Ç–æ —Ç—Ä–µ–±—É–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
1. **–ö—Ä–∏—Ç–∏—á–Ω–æ**: –£–¥–∞–ª–∏—Ç—å –∏–ª–∏ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å–∏ –≤ `menu_categories` —Å –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º `restaurant_id='pnz23-–ø–µ–Ω–∑–∞'`
2. –ü–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å foreign key constraint `fk_menu_categories_restaurant`
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –Ω–µ—Ç –ª–∏ –¥—Ä—É–≥–∏—Ö –ø–æ–¥–æ–±–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º –≤ –¥—Ä—É–≥–∏—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö

### üìä –û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–∏: **85%**

–ú–∏–≥—Ä–∞—Ü–∏—è –ø—Ä–æ—à–ª–∞ –≤ —Ü–µ–ª–æ–º —É—Å–ø–µ—à–Ω–æ, –Ω–æ —Ç—Ä–µ–±—É–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ–¥–Ω–æ–π –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–±–ª–µ–º—ã —Å foreign key constraint.

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚úÖ –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏: `verifyMigration.mjs`
2. ‚úÖ –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫—Ä–∏–ø—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è: `fixMigrationIssues.mjs`
3. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É API –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
4. ‚úÖ –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤—Å–µ foreign key constraints —Å–æ–∑–¥–∞–Ω—ã —É—Å–ø–µ—à–Ω–æ
5. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ —Ü–µ–ª–æ–º

# Объяснение: IP адрес vs доменное имя Railway через проксирование

## В чём разница?

### ❌ Вариант 1: Использование IP адреса напрямую (не рекомендуется)

**Как это работает:**
```
Пользователь → ваш-домен.ru → DNS A запись → IP адрес Railway (например: 52.1.2.3)
```

**Проблемы:**
- Railway использует **динамические IP адреса** — они меняются при перезапуске сервиса
- Если IP изменится, ваш домен перестанет работать
- Нужно постоянно обновлять DNS записи при каждом изменении IP

**Пример настройки DNS:**
- Тип записи: **A**
- Имя: `@` (или `api`)
- Значение: `52.1.2.3` (IP адрес Railway — **но он может измениться!**)

---

### ✅ Вариант 2: Использование доменного имени Railway через проксирование (рекомендуется)

**Как это работает:**
```
Пользователь → ваш-домен.ru → DNS A запись → IP адрес Timeweb (статический, например: 85.198.83.72)
                                                      ↓
                                            Nginx на Timeweb
                                                      ↓
                                    Проксирует запросы на домен Railway
                                    (например: backend.up.railway.app)
                                                      ↓
                                            Railway сервер
```

**Преимущества:**
- Домен указывает на **статический IP Timeweb** (не меняется)
- Nginx на Timeweb использует **доменное имя Railway** (`backend.up.railway.app`), а не IP
- Если IP Railway изменится — это не проблема, потому что доменное имя Railway всегда работает
- Можно настроить автоматическое переключение на запасной сервер (failover)

**Пример настройки DNS:**
- Тип записи: **A**
- Имя: `@` (или `api`)
- Значение: `85.198.83.72` (IP адрес Timeweb — **статический, не меняется**)

**Пример настройки Nginx на Timeweb:**
В конфигурации Nginx указывается **доменное имя Railway**, а не IP:
```nginx
proxy_pass https://backend.up.railway.app;  # ← доменное имя, а не IP!
```

---

## Что такое "проксирование"?

**Проксирование** — это когда один сервер (Timeweb) получает запросы от пользователей и передаёт их дальше на другой сервер (Railway), а потом возвращает ответ обратно пользователю.

**Аналогия:**
- Вы звоните в справочную службу (Timeweb)
- Справочная служба звонит в нужную компанию (Railway) и передаёт вам ответ
- Вы не знаете прямой номер компании, но справочная служба всегда знает, как до неё дозвониться

**В нашем случае:**
- Пользователь обращается к вашему домену (который ведёт на Timeweb)
- Nginx на Timeweb получает запрос и передаёт его на Railway по доменному имени (`backend.up.railway.app`)
- Railway обрабатывает запрос и возвращает ответ
- Nginx передаёт ответ обратно пользователю

---

## Почему доменное имя лучше IP?

| Параметр | IP адрес | Доменное имя Railway |
|----------|----------|---------------------|
| Меняется ли? | Да, при каждом перезапуске | Нет, всегда одно и то же |
| Нужно обновлять DNS? | Да, постоянно | Нет, один раз настроили |
| Работает ли при изменении IP Railway? | Нет, перестанет работать | Да, продолжает работать |
| Можно настроить failover? | Сложно | Да, легко |

---

## Как это выглядит в вашей настройке?

### Текущая схема (с failover):

1. **DNS запись** (в панели регистратора домена):
   - Тип: **A**
   - Имя: `@` (корневой домен)
   - Значение: `85.198.83.72` (IP Timeweb — статический)

2. **Nginx на Timeweb** (конфигурация):
   - Получает запросы на ваш домен
   - Проксирует `/api/` запросы на `https://backend.up.railway.app` (доменное имя Railway)
   - При проблемах с Railway автоматически переключается на локальный backend на Timeweb

3. **Railway**:
   - Работает по своему домену `backend.up.railway.app`
   - IP адрес может меняться, но доменное имя всегда работает

---

## Итог

**"Доменное имя Railway через проксирование"** означает:
- Ваш домен указывает на Timeweb (через статический IP)
- Nginx на Timeweb использует доменное имя Railway (`backend.up.railway.app`) для проксирования запросов
- Не используется IP адрес Railway напрямую в DNS записях

Это надёжнее и позволяет настроить автоматическое переключение на запасной сервер при проблемах.

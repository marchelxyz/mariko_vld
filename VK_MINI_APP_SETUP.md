# Настройка VK Mini App

## Где найти настройки доменов в VK

В VK Mini Apps настройки доменов находятся не в разделе "CORS", а в настройках самого приложения:

### Шаги для настройки:

1. **Перейдите в управление приложениями VK:**
   - Откройте https://vk.com/apps?act=manage
   - Или перейдите в раздел "Мои приложения" в https://dev.vk.com

2. **Выберите ваше Mini App приложение**

3. **Найдите раздел "Настройки" или "Settings"**

4. **В разделе "Мини-приложение" найдите поле "Адрес приложения" или "Application URL"**
   - Здесь должен быть указан URL вашего приложения на Vercel
   - Например: `https://mariko-vld-vk.vercel.app`

5. **Проверьте раздел "Дополнительные настройки" или "Advanced Settings"**
   - Может быть поле "Доверенные домены" или "Trusted Domains"
   - Или "Разрешенные источники" / "Allowed Origins"

### Важно:

- **VK Mini Apps НЕ требуют явной настройки CORS** - домен определяется автоматически из URL приложения
- Если приложение открывается по прямой ссылке, но не работает в iframe VK, проблема может быть в другом

## Возможные проблемы и решения:

### 1. Проверка URL приложения в настройках VK
Убедитесь, что в настройках VK Mini App указан правильный URL:
- Должен быть полный URL с протоколом: `https://mariko-vld-vk.vercel.app`
- Без слеша в конце (или со слешем, в зависимости от настроек VK)

### 2. Проверка Content Security Policy (CSP)
VK может блокировать загрузку ресурсов из-за CSP. Проверьте заголовки ответа от Vercel:
```bash
curl -I https://mariko-vld-vk.vercel.app
```

### 3. Проверка X-Frame-Options
Убедитесь, что Vercel не блокирует загрузку в iframe:
- Проверьте заголовок `X-Frame-Options` в ответе сервера
- Он должен быть `ALLOWALL` или отсутствовать для работы в iframe VK

### 4. Проверка в консоли браузера
Откройте приложение в VK и проверьте консоль браузера (F12):
- Есть ли ошибки загрузки ресурсов?
- Есть ли ошибки JavaScript?
- Доступен ли `window.vk.WebApp`?

## Диагностика

Добавьте в консоль браузера при открытии в VK:

```javascript
// Проверка доступности VK SDK
console.log('window.vk:', window.vk);
console.log('window.vk.WebApp:', window.vk?.WebApp);

// Проверка URL параметров
console.log('URL params:', new URLSearchParams(window.location.search).toString());

// Проверка родительского окна
console.log('Parent:', window.parent !== window);
console.log('Top:', window.top !== window);
```

## Настройка Vercel для работы в iframe

✅ **Уже настроено в `vercel.json`** - добавлены заголовки для разрешения загрузки в iframe:
- `X-Frame-Options: ALLOWALL` - разрешает загрузку в любом iframe
- `Content-Security-Policy: frame-ancestors *` - дополнительная защита для CSP

Эти настройки уже применены в проекте и должны позволить приложению работать в iframe VK.

### Где проверить URL приложения в VK:

1. Перейдите на https://vk.com/apps?act=manage
2. Выберите ваше приложение
3. В разделе **"Настройки"** → **"Мини-приложение"** найдите поле **"Адрес приложения"**
4. Убедитесь, что там указан правильный URL Vercel: `https://mariko-vld-vk.vercel.app`

**Важно:** В VK Mini Apps нет отдельного раздела "CORS" или "Безопасность" - домен определяется автоматически из URL приложения, указанного в настройках.

<!doctype html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>Хачапури Марико - Грузинский ресторан | Заказ онлайн</title>
    <meta name="description" content="Хачапури Марико - лучший грузинский ресторан. Заказывайте хачапури, хинкали и другие блюда грузинской кухни онлайн. Доставка и самовывоз." />
    <meta name="keywords" content="хачапури, марико, грузинская кухня, хинкали, доставка еды, ресторан" />
    <meta name="author" content="Хачапури Марико" />
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Хачапури Марико - Грузинский ресторан" />
    <meta property="og:description" content="Лучший грузинский ресторан. Заказывайте хачапури, хинкали и другие блюда грузинской кухни онлайн." />
    <meta property="og:image" content="/images/logos/khachapuri-mariko-logo.svg" />
    <meta property="og:url" content="https://vhachapuri.ru" />
    
    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Хачапури Марико - Грузинский ресторан" />
    <meta name="twitter:description" content="Лучший грузинский ресторан. Заказывайте хачапури, хинкали и другие блюда грузинской кухни онлайн." />
    <meta name="twitter:image" content="/images/logos/khachapuri-mariko-logo.svg" />
    
    <!-- Critical resource preloads -->
    <link rel="preload" href="/images/heroes/hero-image.svg" as="image" />
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=El+Messiri:wght@400;500;600;700&display=swap" as="style" />
    
    <!-- Preload navigation icons for immediate rendering -->
    <link rel="preload" href="/images/icons/Male User.png" as="image" />
    <link rel="preload" href="/images/icons/House.png" as="image" />
    
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=El+Messiri:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    
    <!-- DNS prefetch for external resources -->
    <link rel="dns-prefetch" href="https://telegram.org" />
    <link rel="dns-prefetch" href="https://vk.com" />
    <link rel="dns-prefetch" href="https://telegra.ph" />
    <link rel="dns-prefetch" href="https://vhachapuri.ru" />
    
    <!-- Single Page Apps for GitHub Pages -->
    <script type="text/javascript">
      (function(l) {
        if (l.search[1] === '/' ) {
          var decoded = l.search.slice(1).split('&').map(function(s) { 
            return s.replace(/~and~/g, '&')
          }).join('?');
          window.history.replaceState(null, null,
              l.pathname.slice(0, -1) + decoded + l.hash
          );
        }
      }(window.location))
    </script>
    
    <style>
      /* Critical CSS for better performance */
      body {
        margin: 0;
        padding: 0;
        overscroll-behavior: none;
        -webkit-overflow-scrolling: touch;
        font-family: 'El Messiri', serif;
        background-color: transparent;
      }

      /* Loading spinner for better UX */
      .loading-spinner {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 40px;
        height: 40px;
        border: 3px solid #f3f3f3;
        border-top: 3px solid #d97706;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        z-index: 9999;
      }

      @keyframes spin {
        0% { transform: translate(-50%, -50%) rotate(0deg); }
        100% { transform: translate(-50%, -50%) rotate(360deg); }
      }

      /* Prevent zoom on iOS */
      input,
      select,
      textarea {
        font-size: 16px !important;
      }

      /* Hide scrollbar but allow scrolling */
      ::-webkit-scrollbar {
        display: none;
      }

      /* Ensure proper mobile viewport */
      html,
      body {
        height: 100%;
        overflow-x: hidden;
      }

      /* Image optimization */
      img {
        max-width: 100%;
        height: auto;
      }
    </style>
  </head>

  <body>
    <!-- Loading spinner -->
    <div id="loading-spinner" class="loading-spinner"></div>
    
    <div id="root"></div>

    <!-- Telegram WebApp API - загружается только если не в VK -->
    <script>
      // Проверяем, запущено ли приложение в VK
      // Если в URL есть параметры VK (vk_app_id), не загружаем Telegram скрипт
      const urlParams = new URLSearchParams(window.location.search);
      const isVK = urlParams.has('vk_app_id') || urlParams.has('vk_user_id') || 
                   (typeof window !== 'undefined' && window.location.href.includes('vk.com'));
      
      if (!isVK) {
        // Загружаем Telegram скрипт только если не в VK
        // В VK Mini Apps window.vk.WebApp доступен автоматически в iframe
        const script = document.createElement('script');
        script.src = 'https://telegram.org/js/telegram-web-app.js';
        script.defer = true;
        document.head.appendChild(script);
      } else {
        // В VK Mini Apps SDK может быть доступен автоматически через window.vk.WebApp в iframe
        // Используем официальные библиотеки @vkid/sdk и @vkontakte/vk-bridge
        console.log('[VK] Определена платформа VK, инициализируем VK Bridge и проверяем WebApp');
        
        // Функция для проверки и инициализации VK SDK
        const initVKSDK = () => {
          // Если WebApp уже доступен, используем его
          if (window.vk && window.vk.WebApp) {
            console.log('[VK] window.vk.WebApp доступен', {
              version: window.vk.WebApp.version,
              platform: window.vk.WebApp.platform,
              initData: window.vk.WebApp.initData ? 'present' : 'missing'
            });
            return true;
          }
          
          // Если window.vk есть, но WebApp нет - возможно это старый формат
          // Пытаемся загрузить официальный SDK через CDN как fallback
          if (window.vk && !window.vk.WebApp) {
            console.log('[VK] window.vk найден, но WebApp отсутствует. Пробуем загрузить SDK через CDN...');
            
            // Загружаем официальный VK Mini Apps SDK через CDN (fallback)
            const vkScript = document.createElement('script');
            vkScript.src = 'https://unpkg.com/@vkid/sdk@latest/dist/umd/index.js';
            vkScript.onload = () => {
              console.log('[VK] SDK загружен через CDN, проверяем WebApp...');
              // SDK может инициализироваться асинхронно
              setTimeout(() => {
                if (window.vk && window.vk.WebApp) {
                  console.log('[VK] window.vk.WebApp теперь доступен', {
                    version: window.vk.WebApp.version,
                    platform: window.vk.WebApp.platform
                  });
                } else {
                  console.warn('[VK] SDK загружен, но WebApp все еще недоступен. Используем VK Bridge из npm пакета.');
                }
              }, 500);
            };
            vkScript.onerror = () => {
              console.warn('[VK] Не удалось загрузить SDK через CDN. Используем VK Bridge из npm пакета @vkontakte/vk-bridge.');
            };
            document.head.appendChild(vkScript);
            return false;
          }
          
          return false;
        };
        
        // Проверяем сразу
        if (!initVKSDK()) {
          // Если SDK не доступен сразу, проверяем с задержкой
          let checkCount = 0;
          const maxChecks = 100; // 10 секунд максимум
          const checkVK = setInterval(function() {
            checkCount++;
            if (window.vk && window.vk.WebApp) {
              console.log('[VK] window.vk.WebApp стал доступен', {
                version: window.vk.WebApp.version,
                platform: window.vk.WebApp.platform,
                initData: window.vk.WebApp.initData ? 'present' : 'missing'
              });
              clearInterval(checkVK);
            } else if (checkCount >= maxChecks) {
              // После 10 секунд прекращаем проверку
              console.warn('[VK] window.vk.WebApp не найден после 10 секунд ожидания. Приложение будет работать через VK Bridge из npm пакета @vkontakte/vk-bridge и fallback режим (URL параметры).');
              clearInterval(checkVK);
            }
          }, 100);
        }
      }
    </script>
    <script type="module" src="/src/main.tsx"></script>
    
    <!-- Remove loading spinner when app loads -->
    <script>
      window.addEventListener('load', function() {
        const spinner = document.getElementById('loading-spinner');
        if (spinner) {
          spinner.style.display = 'none';
        }
      });
    </script>
  </body>
</html>

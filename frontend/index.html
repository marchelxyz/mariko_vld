<!doctype html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>Хачапури Марико - Грузинский ресторан | Заказ онлайн</title>
    <meta name="description" content="Хачапури Марико - лучший грузинский ресторан. Заказывайте хачапури, хинкали и другие блюда грузинской кухни онлайн. Доставка и самовывоз." />
    <meta name="keywords" content="хачапури, марико, грузинская кухня, хинкали, доставка еды, ресторан" />
    <meta name="author" content="Хачапури Марико" />
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Хачапури Марико - Грузинский ресторан" />
    <meta property="og:description" content="Лучший грузинский ресторан. Заказывайте хачапури, хинкали и другие блюда грузинской кухни онлайн." />
    <meta property="og:image" content="/images/logos/khachapuri-mariko-logo.svg" />
    <meta property="og:url" content="https://vhachapuri.ru" />
    
    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Хачапури Марико - Грузинский ресторан" />
    <meta name="twitter:description" content="Лучший грузинский ресторан. Заказывайте хачапури, хинкали и другие блюда грузинской кухни онлайн." />
    <meta name="twitter:image" content="/images/logos/khachapuri-mariko-logo.svg" />
    
    <!-- Critical resource preloads -->
    <link rel="preload" href="/images/heroes/hero-image.svg" as="image" />
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=El+Messiri:wght@400;500;600;700&display=swap" as="style" />
    
    <!-- Preload navigation icons for immediate rendering -->
    <link rel="preload" href="/images/icons/Male User.png" as="image" />
    <link rel="preload" href="/images/icons/House.png" as="image" />
    
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=El+Messiri:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    
    <!-- DNS prefetch for external resources -->
    <link rel="dns-prefetch" href="https://telegram.org" />
    <link rel="dns-prefetch" href="https://telegra.ph" />
    <link rel="dns-prefetch" href="https://vhachapuri.ru" />
    
    <!-- Single Page Apps for GitHub Pages -->
    <script type="text/javascript">
      (function(l) {
        if (l.search[1] === '/' ) {
          var decoded = l.search.slice(1).split('&').map(function(s) { 
            return s.replace(/~and~/g, '&')
          }).join('?');
          window.history.replaceState(null, null,
              l.pathname.slice(0, -1) + decoded + l.hash
          );
        }
      }(window.location))
    </script>
    
    <style>
      /* Critical CSS for better performance */
      body {
        margin: 0;
        padding: 0;
        overscroll-behavior: none;
        -webkit-overflow-scrolling: touch;
        font-family: 'El Messiri', serif;
        background-color: transparent;
      }

      /* Loading spinner for better UX */
      .loading-spinner {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 40px;
        height: 40px;
        border: 3px solid #f3f3f3;
        border-top: 3px solid #d97706;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        z-index: 9999;
      }

      @keyframes spin {
        0% { transform: translate(-50%, -50%) rotate(0deg); }
        100% { transform: translate(-50%, -50%) rotate(360deg); }
      }

      /* Prevent zoom on iOS */
      input,
      select,
      textarea {
        font-size: 16px !important;
      }

      /* Hide scrollbar but allow scrolling */
      ::-webkit-scrollbar {
        display: none;
      }

      /* Ensure proper mobile viewport */
      html,
      body {
        height: 100%;
        overflow-x: hidden;
      }

      /* Image optimization */
      img {
        max-width: 100%;
        height: auto;
      }
    </style>
  </head>

  <body>
    <!-- Loading spinner -->
    <div id="loading-spinner" class="loading-spinner"></div>
    
    <div id="root"></div>

    <!-- Platform detection and conditional SDK loading -->
    <script>
      // Определяем платформу перед загрузкой SDK
      (function() {
        let isVK = false;
        let isTelegram = false;
        
        // Безопасная проверка location (может быть заблокирована в iframe)
        try {
          const search = window.location.search || '';
          const href = window.location.href || '';
          
          isVK = search.includes('vk_') || href.includes('vk.com');
          isTelegram = search.includes('tgWebApp') || search.includes('tgWebAppStartParam') || href.includes('telegram.org');
          
          // Проверяем parent frame только если доступен
          if (typeof window !== 'undefined' && window.parent !== window) {
            try {
              const parentHref = window.parent.location.href || '';
              if (parentHref.includes('vk.com')) {
                isVK = true;
              }
              if (parentHref.includes('telegram.org')) {
                isTelegram = true;
              }
            } catch (e) {
              // Доступ к parent.location заблокирован (нормально для iframe)
            }
          }
        } catch (e) {
          // Доступ к location заблокирован (нормально для iframe VK)
          // Проверяем наличие VK Bridge как альтернативный способ определения платформы
          if (typeof window !== 'undefined' && (window.vk || window.__VK_BRIDGE__)) {
            isVK = true;
          }
        }
        
        // Сохраняем информацию о платформе для использования в приложении
        window.__PLATFORM__ = isVK ? 'vk' : (isTelegram ? 'telegram' : 'web');
        
        // Загружаем Telegram SDK только если это Telegram
        if (isTelegram && !isVK) {
          const script = document.createElement('script');
          script.src = 'https://telegram.org/js/telegram-web-app.js';
          script.defer = true;
          document.head.appendChild(script);
        }
        
        // Загружаем VK SDK только если это VK
        if (isVK) {
          const script = document.createElement('script');
          script.src = 'https://unpkg.com/@vkontakte/vk-bridge/dist/browser.min.js';
          document.head.appendChild(script);
        }
      })();
    </script>
    <script type="module" src="/src/main.tsx"></script>
    
    <!-- Remove loading spinner when app loads -->
    <script>
      window.addEventListener('load', function() {
        const spinner = document.getElementById('loading-spinner');
        if (spinner) {
          spinner.style.display = 'none';
        }
      });
    </script>
  </body>
</html>
